/*!
 * tv-ui v0.2.1 
 * (c) 2019 zhagqn
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.TvUi=t())}(this,function(){"use strict";function e(e){return t(e)||n(e)||i()}function t(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function n(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e,t,n,i,o,r,s,c,f,u){"boolean"!=typeof s&&(f=c,c=s,s=!1);var a="function"==typeof n?n.options:n;e&&e.render&&(a.render=e.render,a.staticRenderFns=e.staticRenderFns,a._compiled=!0,o&&(a.functional=!0)),i&&(a._scopeId=i);var l;if(r?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,f(e)),e&&e._registeredComponents&&e._registeredComponents.add(r)},a._ssrRegister=l):t&&(l=s?function(){t.call(this,u(this.$root.$options.shadowRoot))}:function(e){t.call(this,c(e))}),l)if(a.functional){var d=a.render;a.render=function(e,t){return l.call(t),d(e,t)}}else{var h=a.beforeCreate;a.beforeCreate=h?[].concat(h,l):[l]}return n}function r(e){var t=null,n=function(e){!function t(n){n.hasOwnProperty("_inactive")&&n._inactive||(n.$children&&n.$children.forEach(function(e){t(e)}),n.onKey&&n.onKey(e))}(t)},i=function(e){switch(e.keyCode){case 8:case 10009:n("back");break;case 13:n("enter")}},o=function(e){switch(e.keyCode){case 38:n("up");break;case 40:n("down");break;case 37:n("left");break;case 39:n("right");break;case 427:n("channeldown");break;case 428:n("channelup")}};e.mixin({mounted:function(){this.$parent||t||(t=this.$root,document.onkeyup=i,document.onkeydown=o)}})}var s={getClientRect:function(e){for(var t={x:e.offsetLeft,y:e.offsetTop},n=e.offsetParent;n;)t.x+=n.offsetLeft,t.y+=n.offsetTop,n=n.offsetParent;for(var i=e.parentElement;i;)t.x-=i.scrollLeft,t.y-=i.scrollTop,i=i.parentElement;return t.width=e.offsetWidth,t.height=e.offsetHeight,t},preload:function(e){return new Promise(function(t){var n=new Image;n.src=e,n.onload=function(){t()},n.onerror=function(){t()}})},sleep:function(e){return new Promise(function(t){setTimeout(function(){t()},e)})},nextTick:function(e){return new Promise(function(t){e.$nextTick(function(){t()})})}},c={name:"TvcPanel",props:{focus:{default:!1},value:{default:0,type:Number}},data:function(){return{children:[],focusIndex:-1,focusChild:null}},mounted:function(){this.findChildren()},methods:{onKey:function(e){var t=this;if(this.focus&&["left","right","up","down"].includes(e)){var n=this.directKey(e);n.closestChild?(this.focusChild=n.closestChild,this.focusIndex=n.index,this.scrollIntoView(this.focusChild.$el),this.$emit("focus",this.focusIndex),this.$emit("input",this.focusIndex)):this.$nextTick(function(){t.$emit("blur",e)})}},clearFocus:function(){this.focusIndex=-1,this.focusChild=null},findChildren:function(){function t(e){var n=[];return e.$children.length>0&&e.$children.forEach(function(e){"TvcCell"===e.$options.name?n.push(e):n.push(t(e))}),n}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.value,i=[];i.push.apply(i,e(t(this))),this.children=i,this.children.length>n?(this.focusChild=this.children[n],this.focusIndex=n,this.$emit("focus",this.focusIndex),this.$emit("input",this.focusIndex)):this.children.length>0&&(n=0,this.focusChild=this.children[n],this.focusIndex=n,this.$emit("focus",this.focusIndex),this.$emit("input",this.focusIndex))},directKey:function(e){var t=this,n=t.children,i=t.focusChild,o=-1,r=null,c=0;return n.forEach(function(t,n){if(t._uid!==i._uid){var f=s.getClientRect(t.$el),u=s.getClientRect(i.$el),a=f.x-u.x,l=f.y-u.y,d=Math.sqrt(a*a+l*l);(!c||d<c)&&("left"==e&&a<0||"right"==e&&a>0||"up"==e&&l<0||"down"==e&&l>0)&&(c=d,r=t,o=n)}}),{closestChild:r,index:o}},scrollIntoView:function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0};Math.abs(e.x)<=Math.abs(n.x)&&Math.abs(e.y)<=Math.abs(n.y)&&requestAnimationFrame(function(){c.$refs.wrapper&&(c.$refs.wrapper.scrollLeft+=r.x,c.$refs.wrapper.scrollTop+=r.y,e.x+=r.x,e.y+=r.y,requestAnimationFrame(function(){c.$refs.wrapper&&(c.$refs.wrapper.scrollLeft+=r.x,c.$refs.wrapper.scrollTop+=r.y,e.x+=r.x,e.y+=r.y,t(e))}))})}var n={x:0,y:0},i=s.getClientRect(e),o=s.getClientRect(this.$refs.wrapper);i.x+i.width>o.x+o.width&&(n.x=i.x+i.width-(o.x+o.width)),i.y+i.height>o.y+o.height&&(n.y=i.y+i.height-(o.y+o.height)),i.x<o.x&&(n.x=i.x-o.x),i.y<o.y&&(n.y=i.y-o.y);var r={x:n.x/10,y:n.y/10},c=this;t()}},watch:{value:function(e){this.findChildren(e)},focus:function(e){e&&this.findChildren()}}},f=o;const u=c;var a=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{ref:"wrapper",staticClass:"__tvc-panel",class:e.focus?"focus":""},[e._t("default")],2)},l=[];var d=f({render:a,staticRenderFns:l},void 0,u,void 0,!1,void 0,void 0,void 0);d.install=function(e){e.component(d.name,d)};var h={name:"TvcCell",computed:{focus:function(){return this.$parent.focusChild==this}}};const p=h;var v=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"__tvc-cell",class:e.focus?"focus":""},[e._t("default")],2)},y=[];var m=f({render:v,staticRenderFns:y},void 0,p,void 0,!1,void 0,void 0,void 0);m.install=function(e){e.component(m.name,m)};var x=[d,m],w=[r],$=function e(t){e.installed||(e.installed=!0,x.map(function(e){t.component(e.name,e)}),w.map(function(e){t.use(e)}),t.prototype.$utils=s)};return"undefined"!=typeof window&&window.Vue&&$(window.Vue),{install:$,TvcPanel:d,TvcCell:m}});